#########################
# project configuration #
#########################


# C++ project
language: cpp

os: linux
dist: bionic

################
# build matrix #
################


jobs:
  include:
    - os: linux
      compiler:
        - gcc
        - clang
      before_install:
        - wget --no-check-certificate -O - https://apt.llvm.org/llvm-snapshot.gpg.key | sudo apt-key add -
        - wget -qO - https://apt.kitware.com/keys/kitware-archive-latest.asc | sudo apt-key add -
        - sudo add-apt-repository 'deb https://apt.llvm.org/bionic/ llvm-toolchain-bionic-11 main'
        - sudo apt-add-repository 'deb https://apt.kitware.com/ubuntu/ bionic main'
        - sudo apt-get -q update
        - sudo apt-get -y install clang-11 cmake
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - g++-10
            - libboost-all-dev
            - doctest-dev

################
# build script #
################

script:
  - cmake --version
  - CMAKE_OPTIONS+="-DBUILD_TESTS=ON -DCMAKE_BUILD_TYPE=Release"
  - mkdir -p build && cd build
  - cmake .. ${CMAKE_OPTIONS} && cmake --build
  - ctest -VV -j
